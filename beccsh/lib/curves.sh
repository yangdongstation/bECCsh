#!/bin/bash
# curves.sh - 支持多种椭圆曲线
# 包含secp256r1, secp256k1, secp384r1等标准曲线

# 曲线定义结构：
# 每个曲线包含：p, a, b, Gx, Gy, n, h

# secp256r1 (P-256) - NIST标准曲线
readonly SECP256R1_P="115792089210356248762697446949407573530086143415290314195533631308867097853951"
readonly SECP256R1_A="115792089210356248762697446949407573530086143415290314195533631308867097853948"
readonly SECP256R1_B="41058363725152142129326129780047268409114441015993725554835256314039467401291"
readonly SECP256R1_GX="48439561293906451759052585252797914202762949526041747995844080717082404635286"
readonly SECP256R1_GY="36134250956749795798585127919587881956611106672985015071877198253596914405152"
readonly SECP256R1_N="115792089210356248762697446949407573529996955224135760342422259061068512044369"
readonly SECP256R1_H="1"

# secp256k1 - Bitcoin使用的曲线
readonly SECP256K1_P="115792089237316195423570985008687907853269984665640564039457584007908834671663"
readonly SECP256K1_A="0"
readonly SECP256K1_B="7"
readonly SECP256K1_GX="55066263022277343669578718895168534326250603453777594175500187360389116729240"
readonly SECP256K1_GY="32670510020758816978083085130507043184471273380659243275938904335757337482424"
readonly SECP256K1_N="115792089237316195423570985008687907852837564279074904382605163141518161494337"
readonly SECP256K1_H="1"

# secp384r1 (P-384) - 更高安全级别
readonly SECP384R1_P="39402006196394479212279040100143613805079739270465446667948293404245721771496870329047266088258938001861606973112319"
readonly SECP384R1_A="39402006196394479212279040100143613805079739270465446667948293404245721771496870329047266088258938001861606973112316"
readonly SECP384R1_B="2758019355995970607849028223445720178978875123960259293929437120438843699239729028775223912950546402317996436254009"
readonly SECP384R1_GX="26247035095799689268623156744566981891852923491109213387815615900925518854738050089346156210313581438655224340864196"
readonly SECP384R1_GY="8325710961489029985546751289520108179287853048861315597642602047990433924380039231073394954859324759218459144373943"
readonly SECP384R1_N="3940200619639447921227904010014361380507973927046544666794690527962765939911326356939895630814249494415240690691151"
readonly SECP384R1_H="1"

# 当前使用的曲线（默认secp256r1）
CURVE_NAME="secp256r1"
CURVE_P="${SECP256R1_P}"
CURVE_A="${SECP256R1_A}"
CURVE_B="${SECP256R1_B}"
CURVE_GX="${SECP256R1_GX}"
CURVE_GY="${SECP256R1_GY}"
CURVE_N="${SECP256R1_N}"
CURVE_H="${SECP256R1_H}"

# 设置使用的曲线
set_curve() {
    local curve_name="$1"
    case "$curve_name" in
        secp256r1|p256)
            CURVE_NAME="secp256r1"
            CURVE_P="${SECP256R1_P}"
            CURVE_A="${SECP256R1_A}"
            CURVE_B="${SECP256R1_B}"
            CURVE_GX="${SECP256R1_GX}"
            CURVE_GY="${SECP256R1_GY}"
            CURVE_N="${SECP256R1_N}"
            CURVE_H="${SECP256R1_H}"
            ;;
        secp256k1|bitcoin)
            CURVE_NAME="secp256k1"
            CURVE_P="${SECP256K1_P}"
            CURVE_A="${SECP256K1_A}"
            CURVE_B="${SECP256K1_B}"
            CURVE_GX="${SECP256K1_GX}"
            CURVE_GY="${SECP256K1_GY}"
            CURVE_N="${SECP256K1_N}"
            CURVE_H="${SECP256K1_H}"
            ;;
        secp384r1|p384)
            CURVE_NAME="secp384r1"
            CURVE_P="${SECP384R1_P}"
            CURVE_A="${SECP384R1_A}"
            CURVE_B="${SECP384R1_B}"
            CURVE_GX="${SECP384R1_GX}"
            CURVE_GY="${SECP384R1_GY}"
            CURVE_N="${SECP384R1_N}"
            CURVE_H="${SECP384R1_H}"
            ;;
        *)
            echo "错误：不支持的曲线类型: $curve_name" >&2
            echo "支持的曲线：secp256r1, secp256k1, secp384r1" >&2
            return 1
            ;;
    esac
    
    echo "使用曲线: $CURVE_NAME"
    return 0
}

# 获取曲线信息
get_curve_info() {
    echo "曲线名称: $CURVE_NAME"
    echo "素数 p: ${CURVE_P:0:20}... (${#CURVE_P}位十进制)"
    echo "阶 n: ${CURVE_N:0:20}... (${#CURVE_N}位十进制)"
    echo "系数 a: ${CURVE_A:0:20}..."
    echo "系数 b: ${CURVE_B:0:20}..."
    echo "基点 Gx: ${CURVE_GX:0:20}..."
    echo "基点 Gy: ${CURVE_GY:0:20}..."
    echo "余因子 h: $CURVE_H"
}